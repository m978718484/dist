<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1">
<title>钜商网</title>
</head>
<body>
<div>
	<img src="/dist/static/image/purpose.png" id="myImage">
</div>
<script type=text/javascript src=/dist/static/js/hammer.min.js></script>
<script type="text/javascript">
  var reqAnimationFrame = (function () {
    return window[Hammer.prefixed(window, 'requestAnimationFrame')] || function (callback) {
      window.setTimeout(callback, 1000 / 60);
    };
  })();
  var el = document.querySelector("#myImage");
  var START_X = Math.round((window.innerWidth - el.offsetWidth) / 2);
  var START_Y = Math.round((window.innerHeight - el.offsetHeight) / 2);
  var ticking = false;
  var transform; //图像效果
  var timer;
  var initAngle = 0; //旋转角度
  var initScale = 1; //放大倍数
  var mc = new Hammer.Manager(el); //用管理器 可以同时触发旋转 拖拽 移动
  //var mc = new Hammer(el); //旋转和移动互斥
  /**
  ev.srcEvent.type touchstart touchend touchmove
  ev.deltaX 手势移动位移变量 
  */
  // mc.add(new Hammer.Pan({ threshold: 0, pointers: 0 })); 
  // mc.add(new Hammer.Rotate({ threshold: 0 })).recognizeWith(mc.get('pan'));
  // mc.add(new Hammer.Pinch({ threshold: 0 })).recognizeWith([mc.get('pan'), mc.get('rotate')]);


  mc.on("pinchstart pinchmove", onPinch);
  /**
  第二次进入拖拽时 delta位移重置
  移动时 初始位置startxy不动。delta增加
  */

  function onPinch(ev){
    if(ev.type == 'pinchstart') {
      initScale = transform.scale || 1;
    }
    el.className = '';
    transform.scale = initScale * ev.scale;
    requestElementUpdate(); 
  }

  function updateElementTransform() {
    var value = [
   'translate3d(' + transform.translate.x + 'px, ' + transform.translate.y + 'px, 0)',
   'scale(' + transform.scale + ', ' + transform.scale + ')',
   'rotate3d('+ transform.rx +','+ transform.ry +','+ transform.rz +','+ transform.angle + 'deg)'
   ];
    value = value.join(" ");
    el.style.webkitTransform = value; /*为Chrome/Safari*/
    el.style.mozTransform = value; /*为Firefox*/
    el.style.transform = value; /*IE Opera?*/
    ticking = false;
  }
  function requestElementUpdate() {
    if(!ticking) {
      reqAnimationFrame(updateElementTransform);
      ticking = true;
    }
  }
  /**
  初始化设置
  */
  function resetElement() {
    el.className = 'animate';
    transform = {
      translate: { x: START_X, y: START_Y },
      scale: 1,
      angle: 0,
      rx: 0,
      ry: 0,
      rz: 0
    };
    requestElementUpdate();
  }
  resetElement();
</script>
</body>
</html>